<html>
    <head>
        <meta charset="utf-8">
        <title>Netronner - Tiles Of Fury</title>
        <link href="resources/favicon.ico" rel="icon" type="image/x-icon" />
        <link rel="shortcut icon" href="favicon.ico" />
        <link rel="stylesheet" type="text/css" href="lib/bootstrap.min.css" >
        <script src="lib/jquery-2.0.3.min.js"></script>    
        <script src="lib/handlebars-v1.3.0.js"></script>
        <script src="lib/bootstrap.min.js"></script>
        <script type="text/javascript">
            google = {};
            google.auth = {};
            google.auth.handler = function(ron, authResult) {
                if (authResult['status']['signed_in']) {
                    var accessToken = authResult['access_token'];
                    $.ajax({
                        url: "https://www.googleapis.com/plus/v1/people/me?access_token=" + accessToken,
                        success: function(data) {
                            var username = data["displayName"];
                            var unsizedUserIcon = data["image"]["url"].replace(/\?.*$/, "");
                            ron.logged(accessToken, username, unsizedUserIcon);
                        }
                    });
                } else {
                    console.log('Sign-in failure: ' + authResult['error']);
                }
            }

            function netronner() {
                this.templates = {}
                this.data = {}
                this.webapi = {}
                this.webapi.url = "@@netronner.webapi.url@@"
                this.templates.timeline = Handlebars.compile($("#timeline-template").html())
                this.templates.achievements = Handlebars.compile($("#achievements-template").html())
                this.templates.failure = Handlebars.compile($("#failure-template").html())
                this.templates.anon = Handlebars.compile($("#anon-template").html())
                this.templates.logged = Handlebars.compile($("#logged-template").html())
            }


            netronner.prototype.failure = function(response) {
                function jsonTryParse(txt) {
                    try {
                        return JSON.parse(txt);
                    } catch (ex) {
                        return txt ? {message: txt} : {};
                    }
                }
                this.result(this.templates.failure({
                    status: response.status,
                    value: jsonTryParse(response.responseText)
                }));
            }

            netronner.prototype.result = function(content) {
                $('#results').html(content);
            }

            netronner.prototype.user_result = function(content) {
                $('#user_info').html(content);
            }

            netronner.prototype.timeline = function() {
                this.activateNav("timeline");
                this.data.timeline = [{
                        name: "Angeru",
                        achievements: ["Ragequit", "Vulgar display of power", "To the top! (Rank 5)", "Pinterest", "Four o' four", "Fanpaistic!", "Lack of presence", "D i s c o n n e c t e d", "Delusions of victory"]
                    }, {
                        name: "Bidi",
                        achievements: []
                    }, {
                        name: "Dani",
                        achievements: ["Hell wait", "Die hard", "Bowling alley", "Out of reach", "Vulgar display of power", "Strong", "Stronger", "Fanpaistic!"]
                    }, {
                        name: "Dave",
                        achievements: ["Fanpaistic!", "Strong", "Sanpei", "Vulgar display of power", "To the top! (Rank 3)", "Can't hold all these doras! (Rank 1)"]
                    }, {
                        name: "Foo",
                        achievements: ["Fanpaistic!", "Kan I win?", "Delusions of victory", "Crash course", "Vulgar display of power", "To the top! (Rank 4)", "Unlucky Fourth Object", "Hell wait", "Nine etched fails", "Kan not", "Player killer", "Lack of presence", "Invisible", "Can't hold all these doras! (Rank 1)", "Strongester", "Seventh son of a seventh tile"]
                    }, {
                        name: "Marco",
                        achievements: []
                    }, {
                        name: "Mary",
                        achievements: ["Vulgar display of power"]
                    }, {
                        name: "Marty",
                        achievements: ["Seventh son of a seventh tile", "Vulgar display of power", "It is (not) alone", "Strong"]
                    }, {
                        name: "Mik",
                        achievements: ["Little mermaid", "Fanpaistic!", "Ragequit", "To the top! (Rank 4)", "Player killer", "Hell wait", "Lack of presence", "Invisible", "Strong", "Can't hold all these doras! (Rank 1)"]
                    }, {
                        name: "Mike",
                        achievements: ["Seventh son of a seventh tile"]
                    }, {
                        name: "Pelo",
                        achievements: ["Hell wait", "Fanpaistic!", "To the top! (Rank 1)"]
                    }, {
                        name: "Simo",
                        achievements: ["Four o' four", "To the top! (Rank 3)", "Delusions of victory", "Seventh son of a seventh tile", "It is (not) alone", "Lack of presence", "Fanpaistic!", "Delusions of victory"]
                    }, {
                        name: "Taz",
                        achievements: ["Adoptive parent", "Die hard", "Player killer", "Strong", "Out of reach", "Hell wait", "Delusions of victory"]
                    }];
                this.result(this.templates.timeline(this.data.timeline));
                location.hash = "#timeline";
            }

            netronner.prototype.achievements = function() {
                this.activateNav("achievements");
                this.data.achievements = [{"name": "If you can't beat em....", "description": "deal-in to avoid someone else winning", "category": "boh"}, {"name": "I have an encoding problem! ", "description": "win with a hand composed entirely of pairs/pons/kans of characters and white dragons, then declare BEGINNING OF COSMOS!", "category": ""}, {"name": "Tiles are red, violets are blue... ", "description": "win with all three aka doras and all four red dragons", "category": ""}, {"name": "dragon trainer ", "description": "win with little three dragons", "category": ""}, {"name": "mother of dragons ", "description": "win with big three dragons", "category": ""}, {"name": "all green! ", "description": "win with the green hand", "category": ""}, {"name": "Literate ", "description": "win with an all-characters hand", "category": ""}, {"name": "Bowling alley ", "description": "win with an all-circles hand", "category": ""}, {"name": "A walk in the woods ", "description": "win with an all-bamboos hand", "category": ""}, {"name": "last airbender ", "description": "win with little four winds", "category": ""}, {"name": "in the eye of the storm ", "description": "win with big four winds", "category": ""}, {"name": "pick a seaweed from the bottom of the ocean ", "description": "win with haitei+rinshan kaihou", "category": ""}, {"name": "one shot one kill ", "description": "oneshot an opponent that had 25000+ points at the beginning of the match with a direct hit", "category": ""}, {"name": "player killer ", "description": "reduce an opponent's points below zero with a direct hit", "category": ""}, {"name": "shot on the crowd ", "description": "reduce an opponent's points below zero with a tsumo", "category": ""}, {"name": "grenadier ", "description": "reduce two opponent's points below zero with a single tsumo", "category": ""}, {"name": "nuke from orbit ", "description": "reduce three opponent's points below zero with a single tsumo", "category": ""}, {"name": "o hai, I'm in tenpai! ", "description": "declare a double riichi", "category": ""}, {"name": "I run an orphanage ", "description": "win with thirteen orphans on a thirteen-sided wait", "category": ""}, {"name": "Save the children from the bad guys ", "description": "win with thirteen orphans robbing a closed kan", "category": ""}, {"name": "I'm on fire! ", "description": "stay east for 5 consecutive bonus hands", "category": ""}, {"name": "8th wonder ", "description": "win a bonus hand with 8+ honba", "category": ""}, {"name": "Against a common enemy ", "description": "participate in a double-ron", "category": ""}, {"name": "oath of allegiance ", "description": "participate in a triple-ron", "category": ""}, {"name": "can't hold all these doras ", "description": "win a hand with 6+/9+/12+ doras (rank 1/2/3)", "category": ""}, {"name": "Hell wait ", "description": "win a hand with a 1-out wait", "category": ""}, {"name": "blitzkrieg ", "description": "win a hand with double riichi + ippatsu", "category": ""}, {"name": "god called on the phone .. ", "description": "win with god's hand", "category": ""}, {"name": "vulgar display of power ", "description": "take precedence of a chi/pon declaration with a pon/ron declaration", "category": ""}, {"name": "adoptive parent ", "description": "win with thirteen orphans", "category": ""}, {"name": "they see me ronning, they hatin'  ", "description": " declare three consecutive rons from three different players", "category": ""}, {"name": "fanpaistic! ", "description": "call a fanpai pon at the first round", "category": ""}, {"name": "To the Top ", "description": "finish a game with 30-40-50-60-70-80-90k points (ranks 1-7)", "category": ""}, {"name": "Out of reach ", "description": "call a ron on the riichi declaration tile of another player", "category": ""}, {"name": "unriichiable ", "description": "declare a riichi when you see all your outs among the discards/melds", "category": ""}, {"name": "siberian express ", "description": "win with a pin 9-gates. you must shout SIBERIAN EXPRESS in epic pose", "category": ""}, {"name": "Crash course ", "description": "force an abortive draw declaring the fourth riichi", "category": ""}, {"name": "Four o' four ", "description": " force an abortive draw by calling the fourth kan ", "category": ""}, {"name": "Unlucky fourth object ", "description": "force a draw by discarding the fourth same wind in the first round", "category": ""}, {"name": "D i s c o n n e c t e d ", "description": "open an initial hand with no pairs nor contiguous tiles (brotip: take a screenshot of the hand to claim the achi and keep on playing)", "category": ""}, {"name": "nine etched fails ", "description": "force an abortive draw by having 9+ different orphans on the opening hand", "category": ""}, {"name": "Die Hard ", "description": "finish a game with less than 1k points", "category": ""}, {"name": "invisible", "description": "terminate a full game (east-south match) without any of your tiles being called", "category": ""}, {"name": "lack of presence ", "description": "terminate a complete wind round without any of your tiles being called", "category": ""}, {"name": "superman ", "description": "terminate a game without losing a single point", "category": ""}, {"name": " it is (not) alone", "description": "win on a pair wait on the last closed tile in your hand", "category": ""}, {"name": "ping pon ", "description": "have two players call four consecutive pons from each other (awarded to both)", "category": ""}, {"name": "deja vu ", "description": "call twice the same chi", "category": ""}, {"name": "han solo ", "description": "win waiting for a 1-out character tile", "category": ""}, {"name": "keep it simple ", "description": "score a pinfu", "category": ""}, {"name": "seventh son of a seventh tile ", "description": "score a seven pairs", "category": ""}, {"name": "pinterest ", "description": "call 4+ pin tiles from your opponents in a single game", "category": ""}, {"name": "Little mermaid ", "description": "score a Bottom of the Sea", "category": ""}, {"name": "Sanpei ", "description": "score a Bottom of the River", "category": ""}, {"name": "delusions of victory", "description": "declare a false Ron and suffer a chombo penalty for it", "category": ""}, {"name": "kan I win? ", "description": "score a rinshan kaihou", "category": ""}, {"name": "No pain, no gain", "description": "terminate a full game (east-south match) with a result of +-0", "category": ""}, {"name": "Kan not", "description": "discard four times the same tile in a single game", "category": ""}, {"name": "Strong/Stronger/Strongest", "description": "win a game with 1/2/3 pungs of ⑨ in your hand (open or closed)", "category": ""}, {"name": "Strongester/Strongestest/Strongestestest", "description": "win a game with 1/2/3 kongs of ⑨ in your hn((d open or closed)", "category": ""}]
                this.result(this.templates.achievements(this.data.achievements));
                location.hash = "#achievements";
            }

            netronner.prototype.renderHash = function(_newHash) {
                if (location.hash && location.hash !== "#") {
                    var templateName = location.hash.slice(1);
                    if (typeof netronner.prototype[templateName] === "function") {
                        netronner.prototype[templateName].call(this);
                    }
                }
            };
            
            netronner.prototype.activateNav = function(nav){
                $("#nav li").removeClass("active");
                $("#nav ." + nav).addClass("active");
            };

            netronner.prototype.anon = function() {
                this.data.user = {};
                this.user_result(this.templates.anon(this.data.user));
            }

            netronner.prototype.logged = function(accessToken, username, userIcon) {
                this.data.user = {
                    accessToken: accessToken,
                    username : username,
                    userIcon: userIcon
                };
                this.user_result(this.templates.logged(this.data.user));
            }

            var ron = null;

            $(document).ready(function() {
                ron = new netronner();
                authHandler = google.auth.handler.bind(this, ron);
                if (location.hash && location.hash !== "#") {
                    ron.renderHash()
                } else {
                    ron.timeline();
                }
                ron.anon();
                window.onhashchange = ron.renderHash.bind(ron);
            })
        </script>
        <style>
            html, body { height: 100%; }
            body { background-color: #398439;}
            #wrap {
                min-height: 100%;
                height: auto;
                margin: 0 auto -60px;
                padding: 0 0 60px;
            }
            #wrap > .container { padding: 60px 15px 0; }
        </style>

    </head>
    <body>
        <div id="wrap">
            <div class="navbar navbar-default navbar-fixed-top" role="navigation">
                <div class="container">
                    <div class="navbar-header">
                        <span class="navbar-brand">Netronner</span>
                    </div>
                    <div class="collapse navbar-collapse">
                        <ul class="nav navbar-nav" id="nav">
                            <li class="timeline active"><a href="#timeline">Timeline</a></li>
                            <li class="achievements"><a href="#achievements">Achievements</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="container" >
                <div class="row">
                    <div class="col-md-3">
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <img src="resources/tilesoffury-logo-240-149.png" />
                            </div>
                            <div id="user_info" class="panel-body">
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="row" id="results">
                        </div>
                    </div>

                </div>
            </div>
        </div> 

        <script id="timeline-template" type="text/x-handlebars-template">
            {{#unless this}}
            <div class="row">
            <div class="col-md-12">
            <div class="panel panel-danger">
            <div class="panel-body">Nothing happened.</div>
            </div>
            </div>
            </div>
            {{/unless}}
            {{#each this}}
            <div class="row">
            <div class="col-md-12">
            <div class="panel panel-default">
            <div class="panel-heading">{{name}}</div>
            <div class="panel-body">
            {{#each achievements}}
            <div class="btn-group">
            <a href="#achievements" class="btn btn-info btn-sm">{{this}}</a>
            </div>
            {{/each}}

            </div>
            </div>
            </div>
            </div>
            {{/each}}    
        </script>

        <script id="failure-template" type="text/x-handlebars-template">
            <div class="panel panel-danger">
            <div class="panel-heading">An error occurred</div>
            <div class="panel-body">
            <dl class="dl-horizontal">
            <dt>Error Code</dt><dd>{{status}}</dd>
            {{#each value}}
            <dt>{{@key}}</dt><dd>{{this}}</dd>      
            {{/each}}
            </dl>
            </div>
            </div>
        </script>

        <script id="achievements-template" type="text/x-handlebars-template">
            {{#unless this}}
            <div class="row">
            <div class="col-md-12">
            <div class="panel panel-danger">
            <div class="panel-body">Nothing to achieve here!</div>
            </div>
            </div>
            </div>
            {{/unless}}
            {{#each this}}
            <div class="row">
            <div class="col-md-12">
            <div class="panel panel-default">
            <div class="panel-heading">{{name}}</div>
            <div class="panel-body">
                {{description}}
            </div>
            </div>
            </div>
            </div>
            {{/each}}
        </script>

        <script id="anon-template" type="text/x-handlebars-template">
            <div class="col-md-offset-2 col-md-8">
                <span id="signinButton" >
                    <span
                        class="g-signin"
                        data-callback="authHandler"
                        data-clientid="@@google.client.id@@"
                        data-cookiepolicy="single_host_origin"
                        data-scope="profile">
                    </span>
                </span>
            </div>
        </script>

        <script id="logged-template" type="text/x-handlebars-template">
            <img src="{{userIcon}}?sz=70"
                 class="img-thumbnail"
                 style="width:70px; height:70px; margin:-40px 0 0 0" />
            {{username}}
        </script>


        <!-- Google+ auth -->
        <script type="text/javascript">
            (function() {
                var po = document.createElement('script');
                po.type = 'text/javascript';
                po.async = true;
                po.src = 'https://apis.google.com/js/client:plusone.js';
                var s = document.getElementsByTagName('script')[0];
                s.parentNode.insertBefore(po, s);
            })();
        </script>
    </body>
